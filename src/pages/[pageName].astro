---
import type { GetStaticPaths } from "astro";
import type { PageInfo } from '../types'

import BaseLayout from '../layout/BaseLayout.astro'
import BlockPage from "../components/BlockPage.astro"
import VideoGridPage from "../components/VideoGridPage.astro";

interface Props {
  pageType: 'videoGridPage' | 'blockPage';
  textpageContent: any[];
  mediaItems: any[];
  pageTitle: string;
  pageDescription: string;
}

export const getStaticPaths = (async () => {

  // @TODO resolve literal constant naming inconsistencies within the repository if any
  const SERVER_URL = import.meta.env.NEXT_PUBLIC_SERVER_URL;
  const pagesRequest = await fetch(`${SERVER_URL}api/pages?limit=100&sort=priority`);

  if (pagesRequest.ok) {
    const pagesData = await pagesRequest.json();
    const pagesInfo = pagesData.docs as PageInfo[];

    return pagesInfo
      .map(({ pageName, pageTitle, textpageContent, mediaItems, pageType, pageDescription }) => {
        return {
          params: { pageName },
          props: { textpageContent, mediaItems, pageType, pageTitle, pageDescription }
        }
      }) as any[];
  } else {
    console.error('Failed to fetch pages info from Payload.');
    return [];
  } 
}) satisfies GetStaticPaths;

const {
  pageType,
  textpageContent,
  mediaItems,
  pageTitle,
  pageDescription,
} = Astro.props

---

{
  <BaseLayout
    title={`${pageTitle}`}
    pageDescription={pageDescription}
  >
    {pageType === 'blockPage' ? (
      <BlockPage contentBlocks={textpageContent}/>
    ) : (
      <VideoGridPage mediaItems={mediaItems}/>
    )}
  </BaseLayout>
}
