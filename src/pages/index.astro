---
import BaseLayout from "../layout/BaseLayout.astro"
import BlockPage from "../components/BlockPage.astro"

const SERVER_URL = import.meta.env.NEXT_PUBLIC_SERVER_URL;

let contentBlocks : any[] = [];
const homeContentResponse = await fetch(`${SERVER_URL}api/globals/home?depth=2`);
if (homeContentResponse.ok) {
  const pageData = await homeContentResponse.json();
  contentBlocks = pageData.textpageContent;
} else {
  console.error('Failed to fetch content from payload.');
}

let settings : {
  homeTitle: string;
  homePageDescription: string;
} = {
  homeTitle: 'Home',
  homePageDescription: '',
}
const themeSettingsResponse = await fetch(`${SERVER_URL}api/globals/theme-settings`);
if (themeSettingsResponse.ok) {
  const themeSettings = await themeSettingsResponse.json();
  settings.homeTitle = themeSettings.homePageTitle;
  settings.homePageDescription = themeSettings.homePageDescription;
} else {
  console.error('Failed to fetch home page menu title from payload.');
}

---

<BaseLayout title={settings.homeTitle} pageDescription={settings.homePageDescription}>
  <BlockPage contentBlocks={contentBlocks}/>
</BaseLayout>
